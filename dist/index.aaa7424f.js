!function(){function e(e,t,a,n){var r=void 0===a?1:a;if(Array.isArray(e)||NodeList.prototype.isPrototypeOf(e)||HTMLCollection.prototype.isPrototypeOf(e))for(var c=1==r?0:e.length-1,u=1==r?e.length:0;1==r?c<u:c>u;1==r?c++:c--)t.call(n,e[c],c)}var t,a=function(e,t){for(var a in t)Object.hasOwnProperty.call(t,a)&&(e[a]=t[a])},n=(t={mode:"DEBUG",active_player:null,AI_interval_speed:null,AI_interval:null},{init:function(e){a(t,void 0===e?{}:e)},getCurrentGameState:function(){return t.current_game_state},setCurrentGameState:function(e){a(t,{current_game_state:e})}}),r=debugDetail=function(e){return console.log(e)},c="PICKUP_2",u="PICKUP_7",i="MISS_TURN",o="ANOTHER_TURN",s="CHANGE_DIRECTION",l="CHANGE_SUIT",d=[{value:"A",suit:"hearts",name:"Ace of Hearts",t:2,l:0,power:l},{value:13,suit:"hearts",name:"King of Hearts",t:2,l:12,power:o},{value:12,suit:"hearts",name:"Queen of Hearts",t:2,l:11},{value:11,suit:"hearts",name:"Jack of Hearts",t:2,l:10},{value:10,suit:"hearts",name:"10 of Hearts",t:2,l:9,power:s},{value:9,suit:"hearts",name:"9 of Hearts",t:2,l:8},{value:8,suit:"hearts",name:"8 of Hearts",t:2,l:7,power:i},{value:7,suit:"hearts",name:"7 of Hearts",t:2,l:6},{value:6,suit:"hearts",name:"6 of Hearts",t:2,l:5},{value:5,suit:"hearts",name:"5 of Hearts",t:2,l:4},{value:4,suit:"hearts",name:"4 of Hearts",t:2,l:3},{value:3,suit:"hearts",name:"3 of Hearts",t:2,l:2},{value:2,suit:"hearts",name:"2 of Hearts",t:2,l:1,power:c},{value:"A",suit:"clubs",name:"Ace of Clubs",t:0,l:0,power:l},{value:13,suit:"clubs",name:"King of Clubs",t:0,l:12,power:o},{value:12,suit:"clubs",name:"Queen of Clubs",t:0,l:11},{value:11,suit:"clubs",name:"Jack of Clubs",t:0,l:10,power:u},{value:10,suit:"clubs",name:"10 of Clubs",t:0,l:9,power:s},{value:9,suit:"clubs",name:"9 of Clubs",t:0,l:8},{value:8,suit:"clubs",name:"8 of Clubs",t:0,l:7,power:i},{value:7,suit:"clubs",name:"7 of Clubs",t:0,l:6},{value:6,suit:"clubs",name:"6 of Clubs",t:0,l:5},{value:5,suit:"clubs",name:"5 of Clubs",t:0,l:4},{value:4,suit:"clubs",name:"4 of Clubs",t:0,l:3},{value:3,suit:"clubs",name:"3 of Clubs",t:0,l:2},{value:2,suit:"clubs",name:"2 of Clubs",t:0,l:1,power:c},{value:"A",suit:"diamonds",name:"Ace of Diamonds",t:1,l:0,power:l},{value:13,suit:"diamonds",name:"King of Diamonds",t:1,l:12,power:o},{value:12,suit:"diamonds",name:"Queen of Diamonds",t:1,l:11},{value:11,suit:"diamonds",name:"Jack of Diamonds",t:1,l:10},{value:10,suit:"diamonds",name:"10 of Diamonds",t:1,l:9,power:s},{value:9,suit:"diamonds",name:"9 of Diamonds",t:1,l:8},{value:8,suit:"diamonds",name:"8 of Diamonds",t:1,l:7,power:i},{value:7,suit:"diamonds",name:"7 of Diamonds",t:1,l:6},{value:6,suit:"diamonds",name:"6 of Diamonds",t:1,l:5},{value:5,suit:"diamonds",name:"5 of Diamonds",t:1,l:4},{value:4,suit:"diamonds",name:"4 of Diamonds",t:1,l:3},{value:3,suit:"diamonds",name:"3 of Diamonds",t:1,l:2},{value:2,suit:"diamonds",name:"2 of Diamonds",t:1,l:1,power:c},{value:"A",suit:"spades",name:"Ace of Spades",t:3,l:0,power:l},{value:13,suit:"spades",name:"King of Spades",t:3,l:12,power:o},{value:12,suit:"spades",name:"Queen of Spades",t:3,l:11},{value:11,suit:"spades",name:"Jack of Spades",t:3,l:10,power:u},{value:10,suit:"spades",name:"10 of Spades",t:3,l:9,power:s},{value:9,suit:"spades",name:"9 of Spades",t:3,l:8},{value:8,suit:"spades",name:"8 of Spades",t:3,l:7,power:i},{value:7,suit:"spades",name:"7 of Spades",t:3,l:6},{value:6,suit:"spades",name:"6 of Spades",t:3,l:5},{value:5,suit:"spades",name:"5 of Spades",t:3,l:4},{value:4,suit:"spades",name:"4 of Spades",t:3,l:3},{value:3,suit:"spades",name:"3 of Spades",t:3,l:2},{value:2,suit:"spades",name:"2 of Spades",t:3,l:1,power:c}],p=function(){var t=d,n=[],c={starting_hand_size:7},u=function(){i(t,s,m)},i=function(t,a,n){var r,c;e(t,(function(e,t){r=Math.floor(Math.random()*t),c=a(t-1),n(t-1,a(r)),n([r],c)}),-1)},o=function(){return n.length},s=function(e){return t.splice(e,1)[0]},l=function(e){return n.splice(e,1)[0]},p=function(e){return t.splice(0,e)},f=function(e){return n.splice(e,1)[0]},m=function(e,a){t.splice(e,0,a)},y=function(e,t){n.splice(e,0,t)},v=function(e){t.unshift(e)},_=function(e){n.unshift(e)};return{init:function(e){a(c,e)},prepareDeck:function(){u(),y(0,s(0))},getPickupDeck:function(){return t},getPickupDeckSize:function(){return t.length},getPickupDeckTopCard:function(){return t[0]},removeCardByIndexFromPickupDeck:s,removeFirstNCardsFromPickupDeck:p,removeCardAtIndexFromPickupDeck:function(e){return t.splice(e,1)[0]},insertCardAtIndexToPickupDeck:m,insertToTopOfPickupDeck:v,getDiscardDeck:function(){return n},getDiscardDeckSize:o,getDiscardDeckTopCard:function(){return n[0]},removeCardByIndexFromDiscardDeck:l,removeFirstNCardsFromDiscardDeck:function(e){return n.splice(0,e)},removeCardAtIndexFromDiscardDeck:f,insertCardAtIndexToDiscardDeck:y,insertToTopOfDiscardDeck:_,shufflePickUpDeck:u,shuffleDiscardDeck:function(){i(n,l,y)},swapDecks:function(){r("Refilling Pickup Deck from Discard Deck");for(var e=f(0),t=0;t<o();t++)v(l(t));_(e)},dealCards:function(t){e(t,(function(e,t){var a=p(c.starting_hand_size);e.addCards(a)}))}}}(),f="IDLE",m="TO_PLAY",y="HAS_PLAYED",v="DID_PICKUP",_="DID_PUTDOWN",g="NO_ACTION",P="MUST_PICK_2",k="MUST_PICK_7",C="MUST_MISS_TURN",h="EFFECT_ANOTHER_TURN",D="EFFECT_NO_EFFECT",w=function(){var t={num_players:4,player_list:[],current_player_idx:0,previous_player_idx:null,next_player_idx:null,play_direction:1},n=function(){var e=t.current_player_idx+t.play_direction;return e<0?t.num_players-1:e>=t.num_players?0:e},c=function(){var e=t.current_player_idx-t.play_direction;return e<0?t.num_players-1:e>=t.num_players?0:e};return{init:function(e){a(t,e),t.previous_player_idx=c(),t.next_player_idx=n()},createPlayers:function(n){e(n,(function(e){var n=function(){var e={name:null,deck:[],el:null,is_human:!1,status:{play_state:f,action:g,effect:D}};return{init:function(t){a(e,t)},addCard:function(t){e.deck.push(t)},addCards:function(t){e.deck=e.deck.concat(t)},removeCard:function(t){var a=t.value,n=t.suit,r=e.deck.findIndex((function(e){return e.value==a&&e.suit==n}));return r<0&&console.error("Selected player card not found"),e.deck.splice(r,1)[0]},removeCardAtIndex:function(t){e.deck.splice(t,1)[0]},removeCards:function(t,a){e.deck.splice(t,a)},getPlayerName:function(){return e.name},getCurrentCards:function(){return e.deck},getIsHuman:function(){return e.is_human},getHandSize:function(){return e.deck.length},getPlayerEl:function(){return e.el},resetStatus:function(){e.status={play_state:f,action:g,effect:D}},getStatus:function(){return e.status},updatePlayState:function(t){[f,m,y].includes(t)||r("".concat(e.name," [state.play_state] provided unacceptable state: ").concat(t)),e.status.play_state=t,r("".concat(e.name," [state.play_state] is now ").concat(t))},getPlayState:function(){return e.status.play_state},updateActionState:function(t){[v,_,g].includes(t)||r("".concat(e.name," [state.action_state] provided unacceptable state: ").concat(t)),e.status.action=t,r("".concat(e.name," [state.action] is now ").concat(t))},getActionState:function(){return e.status.action},updateEffectState:function(t){[P,k,C,h,D].includes(t)||r("".concat(e.name," [state.effect_state] provided unacceptable state: ").concat(t)),e.status.effect=t,r("".concat(e.name," [state.effect] is now ").concat(t))},getEffectState:function(){return e.status.effect}}}();n.init({is_human:e.is_human,name:e.name,el:e.el}),t.player_list.push(n)}))},setNextActivePlayer:function(){t.current_player_idx=t.next_player_idx,t.previous_player_idx=c(),t.player_list[t.previous_player_idx].resetStatus(),t.next_player_idx=n();var e=t.player_list[t.current_player_idx];e.getEffectState()===D&&e.updatePlayState(m),r("Current active player is now: ".concat(e.getPlayerName()))},getCurrentActivePlayer:function(){return t.player_list[t.current_player_idx]},getCurrentActivePlayerIdx:function(){return t.current_player_idx},getCurrentNextPlayer:function(){return t.player_list[t.next_player_idx]},getCurrentNextPlayerIdx:function(){return t.next_player_idx},getCurrentPreviousPlayer:function(){return t.player_list[t.previous_player_idx]},getCurrentPreviousPlayerIdx:function(){return t.previous_player_idx},getPlayerList:function(){return t.player_list},changePlayDirection:function(){t.play_direction=-1*t.play_direction,t.next_player_idx=t.previous_player_idx}}}(),S=function(){var e={pickup_deck_el:null,discard_deck_el:null,updates_board_el:null,card_w:59,card_h:90},t=function(t,a){return'<img class="'.concat(a?"face_up":"face_down",'" style="background-position: -').concat(t.l*e.card_w,"px -").concat(t.t*e.card_h,'px;"/>')};return{init:function(t){a(e,void 0===t?{}:t)},createListedCardHTML:function(e,a){return'<li class="card" data-v="'.concat(e.value,'" data-s="').concat(e.suit,'">\n                ').concat(t(e,a),"\n            </li>")},createCardHTML:t,getPickupDeck:function(){return e.pickup_deck_el},getDiscardDeck:function(){return e.discard_deck_el},getGameUpdateBoard:function(){return e.updates_board_el}}}(),A=drawPlayerDecks=function(){e(w.getPlayerList(),(function(t){var a=t.getCurrentCards(),n=t.getPlayerEl().querySelector(".card_list");n.innerHTML="",e(a,(function(e){n.insertAdjacentHTML("beforeend",S.createListedCardHTML(e,t.getIsHuman()))}))}))},b=drawDiscardDeck=function(){var e=p.getDiscardDeck()[0];S.getDiscardDeck().innerHTML=S.createCardHTML(e,!0)},T=updateView=function(){A(),b()},I=outputToBoard=function(e){var t=S.getGameUpdateBoard();t.insertAdjacentHTML("beforeend","<p>".concat(e,"</p>")),t.scrollTop=t.scrollHeight},E=hasWinConditionBeenReached=function(){r("[hasWinConditionBeenReached] Checking win condition");var e=w.getCurrentActivePlayer().getHandSize();return r("[hasWinConditionBeenReached] Player has ".concat(e," cards remaining")),0===e},x=applyPowerEffect=function(e){var t=w.getCurrentActivePlayer(),a=w.getCurrentNextPlayer();switch(e){case s:I("Direction of play is reversed!"),w.changePlayDirection();break;case l:I("New suit chosen! [TODO]");break;case o:I("".concat(t.getPlayerName()," to take another turn!")),t.updateEffectState(h);break;case i:I("".concat(a.getPlayerName()," to miss a turn!")),a.updateEffectState(C);break;case c:I("".concat(a.getPlayerName()," must pick up 2 cards!")),a.updateEffectState(P);break;case u:I("".concat(a.getPlayerName()," must pick up 7 cards!")),a.updateEffectState(k);break;default:debugDetail("[applyPowerEffect] Unknown power applied! ".concat(e))}},H=checkLegalPlayableMove=function(e){var t=e.value,a=e.suit,n=p.getDiscardDeckTopCard();return t==n.value||a==n.suit},N=handlePlayCard=function(e){var t=e.value,a=e.suit,n=w.getCurrentActivePlayer(),c=n.removeCard({value:t,suit:a});r("[playCard] Playing card: ".concat(c.name)),p.insertToTopOfDiscardDeck(c),n.updateActionState(_),outputToBoard("".concat(n.getPlayerName()," has played the ").concat(c.name)),updateView()},M=playCard=function(e){var t=e.value,a=e.suit;return r("[handlePlayCard] Attempting to play"),H({value:t,suit:a})?(N({value:t,suit:a}),!0):(r("[handlePlayCard] Card not playable"),I("That card isn't playable!"),!1)},L=onAIPlayerCardSelect=function(e){r("[onAIPlayerCardSelect] Playing a card from hand");var t=e.filter((function(e){return void 0!==e.power})),a=null;a=t.length&&Math.random()>.4?t[Math.floor(Math.random()*t.length)]:e[Math.floor(Math.random()*e.length)],M({value:a.value,suit:a.suit}),G()},B=pickupCardFromDeck=function(){r("[pickupCardFromDeck] Picking up card");var e=w.getCurrentActivePlayer(),t=p.removeCardByIndexFromPickupDeck(0);e.addCard(t),r("[pickupCardFromDeck] Picked up card: ".concat(t.name)),p.getPickupDeckSize()<=0&&p.swapDecks(),e.updateActionState(v),I("".concat(e.getPlayerName()," has picked up")),T()},O=handleCardPickup=function(e){B(),G()},F=chooseAIPlayerActionChoice=function(){var e=Players.getCurrentActivePlayer().getCurrentCards().filter((function(e){return H(e)}));r("[chooseAIPlayerActionChoice] Number of playable cards: ".concat(e.length)),e.length&&Math.random()>=.3?(r("[chooseAIPlayerActionChoice] Player has chosen to play a card"),L(e)):(r("Player must pickup"),O())},U=handleTurnBegin=function(){var e=w.getCurrentActivePlayer();e.getEffectState()!==D?(r("Current player is affected by ".concat(e.getEffectState())),R(e,e.getEffectState())):(outputToBoard("".concat(e.getPlayerName()," to play...")),e.getIsHuman()||(r("[chooseAIPlayerActionChoice] Player is thinking..."),window.setTimeout(F,2e3)))},R=resolvePowerEffectState=function(e,t){var a=w.getCurrentActivePlayer();switch(t){case h:r("[resolvePowerEffectState] Player taking another turn [TODO]"),a.resetStatus(),a.updatePlayState(m),U();break;case C:r("[resolvePowerEffectState] Missing Turn"),G();break;case P:r("[resolvePowerEffectState] Picking up 2 cards");for(var n=0;n<2;n++)B();G();break;case k:for(var c=0;c<7;c++)B();G();break;default:r("[resolvePowerEffectState] Unknown effect state applied! ".concat(t))}},K=onEndTurn=function(){w.setNextActivePlayer(),r("[chooseAIPlayerActionChoice] It is now ".concat(w.getCurrentActivePlayer().getPlayerName(),"s turn")),U()},G=endTurn=function(){var e=w.getCurrentActivePlayer();if(e.updatePlayState(y),r("[endTurn] Ending turn..."),r("[endTurn] actionState of current player: ".concat(e.getActionState())),e.getActionState()===_){var t=Deck.getDiscardDeckTopCard();if(t.power&&(r("[endTurn] Card putdown is a power card: ".concat(t.power)),I("It's a power card!"),x(t.power),e.getEffectState()!==D))return void R(e,e.getEffectState())}E()?(I("".concat(w.getCurrentActivePlayer().getPlayerName()," is the winner!")),r("[endTurn] ".concat(w.getCurrentActivePlayer().getPlayerName()," has won!"))):(r("------------"),K())},z=onHumanPlayerCardSelect=function(e){if(r("[onHumanPlayerCardSelect]"),w.getCurrentActivePlayer().getIsHuman()){var t=e.target.parentNode||e.srcElement.parentNode;if("card"==t.className){var a=t.getAttribute("data-v"),n=t.getAttribute("data-s");M({value:a,suit:n})&&G()}}else r("[onHumanPlayerCardSelect] Human player not currently active")};window.Game=n,window.Deck=p,window.Players=w,window.View=S;document.querySelector("#game_instructions button").addEventListener("click",(function(){document.querySelector("#game_instructions").remove(),n.init({}),w.init({num_players:4}),S.init({pickup_deck_el:document.getElementById("pickup_deck"),discard_deck_el:document.getElementById("discard_deck"),updates_board_el:document.getElementById("game_updates")}),p.init({}),w.createPlayers([{el:document.getElementById("Player_0"),is_human:!0,name:"Human Player"},{el:document.getElementById("Player_1"),is_human:!1,name:"AI Player 1"},{el:document.getElementById("Player_2"),is_human:!1,name:"AI Player 2"},{el:document.getElementById("Player_3"),is_human:!1,name:"AI Player 3"}]),p.prepareDeck(),p.dealCards(w.getPlayerList()),T(),document.querySelector("#pickup_deck").addEventListener("mousedown",O),w.getPlayerList().find((function(e){return e.getIsHuman()})).getPlayerEl().querySelector(".card_list").addEventListener("mousedown",z),I("The starting card is a ".concat(p.getDiscardDeckTopCard().name))}))}();
//# sourceMappingURL=index.aaa7424f.js.map
